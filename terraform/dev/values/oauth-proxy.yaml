proxyVarsAsSecrets: true

config:
  existingSecret: oauth2-proxy-secret

extraArgs:
  # OIDC
  provider: oidc
  oidc-issuer-url: https://login.microsoftonline.com/8a25df97-9f2b-4ef1-a9e7-3faf585640e8/v2.0
  redirect-url: https://oauth.dev.audioprothese.ovh/oauth2/callback
  oidc-email-claim: preferred_username

  # domaine autorisé pour les redirections
  whitelist-domain: "*.audioprothese.ovh"

  # on ne veut pas stocker le token dans le cookie (évite de dépasser 4 KB)
  pass-access-token: "false"
  set-authorization-header: "false"
  cookie-domain: ".audioprothese.ovh"        
  cookie-samesite: none
  cookie-secure: "true"

  # on contourne l’auth pour les endpoints internes
  skip-auth-route:
    - GET=/oauth2/ping
    - GET=/oauth2/ready
    - GET=/oauth2/callback.*
  skip-jwt-bearer-tokens: "true"

  # dans votre cas d’usage “auth_request” derrière un ingress
  set-xauthrequest: "true"
  reverse-proxy: "true"

ingress:
  enabled: true
  ingressClassName: webapprouting.kubernetes.azure.com
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - oauth.dev.audioprothese.ovh
  # on expose **uniquement** /oauth2/* vers oauth2-proxy
  path: /oauth2
  pathType: Prefix
  tls:
    - hosts:
        - oauth.dev.audioprothese.ovh
      secretName: oauth-tls

service:
  type: ClusterIP
  portNumber: 4180
